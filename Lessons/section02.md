# Page Router

## Page Router 소개

- 현재 많은 기업에서 사용되고 있는 안정적인 라우터
- React Router 처럼 페이지 라우팅 기능을 제공함
- Page Router는 이름에 걸맞게 pages 폴더의 구조를 기반으로 페이지를 라우팅함
- Pages 폴더 아래에 들어있는 파일명과 폴더명을 기반의 페이지 라우팅
- 이번 시간에 우리는 Next.js의 페이지 라우터에서 제공하는 다양한 기능을 사용하여 정적, 동적, 범용적인 경로 그리고 없는 경로에까지 대응하는 페이지를 만들어 본다.
- 동적 경로 (Dynamic Routes): 경로 상에 변할 수 있는 가변적인 값을 포함하고 있는 경로

> Page Router 이미지

- import alias: 절대 경로로 모듈을 import 할 수 있도록 도와주는 기능. 경로가 복잡해지더라도 해당 구문을 사용하면 더 간결할하게 작성할 수 있다.

## Page Router 실습

- pages 폴더 아래 \_app.tsx, \_documents.tsx 의 역할은 Pages 폴더 밑에 있긴 하지만 페이지의 역할을 하는 파일은 아니다. 대신에 넥스트 앱의 모든 페이지에 공통적으로 적용될 로직이나 레이아웃 또는 데이터를 다루기 위해서 필요한 파일들이다.

### \_app.tsx 컴포넌트

- Next.js의 \_app.tsx 컴포넌트의 경우에는 모든 페이지 역할을 하는 컴포넌트들의 부모 컴포넌트가 된다.
- \_app.tsx 컴포넌트는 페이지와 페이지의 컴포넌트를 받아 뿌려주고 있다.

### \_document.tsx 컴포넌트

- \_document.tsx 컴포넌트는 모든 페이지에 공통적으로 적용되어야 하는 Next.js 앱의 HTML 코드를 설정한다. 기존 리액트 앱의 index.html과 거의 비슷한 역할을 한다.
- \_document.tsx 컴포넌트에는 모든 페이지에 적용되어야 하는 메타 태그를 설정한다거나, 폰트를 불러온다거나, 캐릭터 셋을 설정한다거나, 구글 애널리틱스 같은 서드 파티 스크립트를 넣는다는 등등의 HTML 태그를 관리하는 작업을 한다.

### next.config.mjs

- 넥스트 앱의 설정을 관리하는 파일
- reactStrictMode는 true에서 false로 꺼둔다. 이유는 개발모드로 실행했을 때 컴포넌트를 두 번이나 실행하기 때문에 디버깅에 불편함이 있기 때문이다.

### search 페이지: 쿼리스트링 (useRouter)

- 쿼리스트링의 경우에는 페이지의 경로에는 영향을 주지 않는다. 쿼리스트링을 읽어오기 위해서 페이지 경로에 따로 설정해줄 필요는 없다. 대신에 컴포넌트 내부에 useRouter 훅을 불러와서 라우터의 쿼리라는 프로퍼티를 통해서 불러온다.
- 쿼리 스트링을 읽어오기 위해 2번 실행된다. 첫번째 실행에서는 쿼리값이 없고, 두번째 실행에서 쿼리값일 있음을 확인해볼 수 있다.

### books 페이지: URL 파라미터

- 동적 경로를 갖는 페이지를 생성하는데 사용된다.
- Next.js가 대괄호가 포함된 파일명을 보고 /book/[id] 라는 가변적인 URL 파라미터를 갖는 동적 경로에 대응하는 파일이라는 것을 인식한다.
- URL 파라미터도 query 스트링과 같은 방식으로 라우터 객체에 저장된다.
- 파라미터가 id를 key로 하여 저장되어 있는 이유는 앞서 Page에 대응하는 이름을 정할 때 [id].tsx 라는 이름으로 만들어 두었기 때문이다.
- 현재는 `/book/123` 이런 식의 바로 아래 경로에만 대응하지만 그 하위로 `/book/1/12/213/23/13` 식의 경로에도 대응하려면 [...id].tsx 형태로 변경해주면 된다.
- `...`은 book이라는 경로 뒤에 여러개의 id가 연달아 들어올 있고 그러한 모든 id에 다 대응하겠다는 것을 의미한다.
- Next.js에서는 특별히 이런 식으로 설정되어 있는 경로를 모든 경로를 다 잡아채겠다는 의미로, Catch All Segment (구간)라고 부른다.
- `Catch All Segment` 형태로 설정되어 있는 URL 파라미터들은 컴포넌트의 라우터 객체에 배열식으로 저장이 된다.

> 배열형태로 저장되는 URL 파라미터들

- Catch All Segment로도 대응할 수 없는 경로가 있다. 그것은 URL 파라미터가 아무것도 없는 상태의 경로이다 (/book 으로 끝나는 경우).
- 이러한 경우 두가지 방식으로 대응할 수 있는데 같은 book 경로에 index.tsx 파일을 생서해주던지, 범용적으로 book 이후 어떤 경로가 나오든 안 나오든 대응이 가능한 방법을 사용하는 것이다.
- index.tsx 역할까지 겸용하는 완전히 범용적인 페이지로 이후 모든 경로를 포한하는 경우에는 [[...id]].tsx 처럼 폴더 명에 대괄호를 한번 더 씌워주면 된다. 이렇게 설정된 페이지를 `Optional Catch All Segment`라고 부른다.

### 404 페이지

- 없는 경로에 대응할 수 있다.
- Pages 폴더 밑에 404.tsx 파일을 만들면 된다.
